# image: liuyangzhuan/superlu_gpu_amd64:v1.2
# stages:
#   - build

# # -------------------------
# # Debug job to inspect hpsf image
# # -------------------------
# debug:hpsf:
#   stage: build
#   tags: 
#     # - hpsf
#     - x86_64-nvidiagpu
#   script:
#     - cd ~/superlu_dist
#     - bash runit.sh




image: liuyangzhuan/superlu_gpu_amd64:v1.2

stages:
  - build
  - test

build:
  stage: build
  tags: [hpsf-gpu, x86_64-nvidiagpu, nvidia-a100]
  script:
    - cd ~/superlu_dist

  artifacts:
    paths:
      - build
    expire_in: 1 week

test 1/4:
  stage: test
  tags: [hpsf-gpu, x86_64-nvidiagpu, nvidia-a100]
  script:
    - export TEST_NUMBER=1
    - sh runit.sh

test 2/4:
  stage: test
  tags: [hpsf-gpu, x86_64-nvidiagpu, nvidia-a100]
  script:
    - export TEST_NUMBER=2
    - sh runit.sh

test 3/4:
  stage: test
  tags: [hpsf-gpu, x86_64-nvidiagpu, nvidia-a100]
  script:
    - export TEST_NUMBER=3
    - sh runit.sh

test 4/4:
  stage: test
  tags: [hpsf-gpu, x86_64-nvidiagpu, nvidia-a100]
  script:
    - export TEST_NUMBER=4
    - sh runit.sh

